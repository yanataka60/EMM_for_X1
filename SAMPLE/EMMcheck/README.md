# EMMCHECK for X1_SD

　EMMボートの512K S-RAMの内容とX1_SDのファイルの内容を比較します。

　X1、X1turboで実行可能です。

　バッテリーバックアップが正常に機能しているかチェックするためのプログラムです。

## EMMCHECKの作成
　EMMCHECK.binを使いますが、BASIC CZ-8CB01から抜き出したIOCS(0000h～149Fh)が必要です。

　基本的にはX1_SDでの「ROMへの書込み」と同様です。

　まず、BASIC CZ-8CB01からIOCS(0000h～149Fh)を抜き出し、バイナリファイルとして保存します。

　CZ-8FB01 V10、CZ-8FB01 V20も大丈夫だとは思いますが、検証していません。なお、X1turbo用BASICは使えません。

　　DumpList Editorを使ってBASIC CZ-8CB01のWav又はtapファイルを読み込み、「マシン語入力に送る」を実行します。

　　マシン語の14A0h以降を削除します。(0000h～149Fhのマシン語にします)

　　「ファイル書出し」の「BIN(mot)ファイル書き出し(ヘッダ無し)(for他汎用)」を選択して「IOCS.bin」という名前で保存します。

　保存した「IOCS.bin」の後ろにバイナリエディタ等を使って「EMMCHECK.bin」を付け加えます。0000h～19B5hのファイルとなるはずです。

　次にファイルの先頭に以下に示す32Byteのヘッダを付加します。0000h～19D5hのファイルとなります。

　[0000] 01 45 4D 4D 43 48 45 43 4B 20 20 20 20 20 20 20

　[0010] 20 20 B5 19 00 00 00 00 20 20 20 20 20 20 00 00

　出来上がったら「EMMCHECK.X1T」という名前で保存します。

## EMMCHECKの使い方
　起動するとまず対象とするEMMをEMM0～EMM3の中から数字で選択します。

　次に比較するファイルを指定します。

　「FNAME:」と聞いてきますので次のうちから選択して入力します。

### [BREAK]キー
　処理が中断されたものとしてMONITOR入力待ちに戻ります。

### DOSファイル名を入力せずそのまま[CR]キー
　選択したEMMに対応するEMMx.X1T(EMM0.X1T、EMM1.X1T、EMM2.X1T、EMM3.X1T)をDOSファイル名として比較します。

### DOSファイル名を入力して[CR]キー
　入力されたDOSファイル名のファイルと比較とします。拡張子の「X1T」は省略可能です。

### *F xxx[CR]キー
　SDカードに保存されている文字列xxxから始まるDOSファイル名を一覧表示します。xxxを省略した場合はすべてのファイルが一覧表示対象となります。

　20件表示したところで指示待ちになるので打ち切るならSHIFT+BREAK又は↑を入力すると打ち切られ、Bキーで前の20件に戻ります。それ以外のキーで次の20件を表示します。

　検索結果の行頭には「FNAME:」を付加して表示してあるので比較したいファイルにカーソルキーを合わせて[CR]キーを押すだけで選択が可能です。

例)

FNAME:[CR]

FNAME:EMM0-TEST[CR]

FNAME:*F EMM[CR]

